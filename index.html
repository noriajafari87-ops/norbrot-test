<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Barbari-Brot - norbrot</title>

  <link rel="stylesheet" href="styles.css?v=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <script src="languages.js" defer></script>
  <script src="script.js" defer></script>
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo"><i class="fas fa-bread-slice"></i><span>norbrot</span></div>
      <div class="nav-right">
        <div class="language-switcher">
          <button class="lang-btn active" data-lang="de">Deutsch</button>
          <button class="lang-btn" data-lang="en">English</button>
          <button class="lang-btn" data-lang="tr">Türkçe</button>
          <button class="lang-btn" data-lang="fa">فارسی</button>
        </div>
      </div>
    </div>
  </nav>

  <section class="product-page elderly-friendly page-decor">
    <div class="container">
      <div class="products-grid">
        <!-- White Flour Barbari Bread -->
        <div class="product-card">
          <div class="gallery card-3d image-elevated">
            <span class="ribbon ribbon-new"><i class="fas fa-star"></i> <span class="new">Neu</span></span>
            <div class="gallery-main">
              <img id="whiteBreadImage"
                   src="Image/Non.jpg"
                   data-candidates="Image/Non.jpg,./Image/Non.jpg,/Image/Non.jpg,image/Non.jpg,Image/non.jpg,Non.jpg,./Non.jpg,/Non.jpg,https://via.placeholder.com/1200x800.png?text=White+Bread"
                   loading="eager"
                   alt="Barbari-Brot mit weißem Mehl" class="gallery-img"/>
              <span class="shine"></span>
            </div>
          </div>

          <div class="order-panel details-glass">
            <h3 class="product-title whiteFlourBread">Barbari-Brot mit weißem Mehl</h3>
            <div class="order-header-ui">
              <div class="price-chip"><span class="price-label">Preis:</span> <strong>1,70 €</strong></div>
              <div class="stock-chip"><i class="fas fa-check"></i> <span class="available-today">Heute verfügbar</span></div>
            </div>

            <ul class="usp-list">
              <li><i class="fas fa-bread-slice"></i> <span class="handmade">Handgemacht, knusprig außen – weich innen</span></li>
              <li><i class="fas fa-calendar"></i> <span class="baking-schedule">Backtage: Samstag und Sonntag (11:00-13:00 Uhr)</span></li>
              <li><i class="fas fa-leaf"></i> <span class="no-additives">Ohne Zusatzstoffe – gesund und nahrhaft für die Familie</span></li>
            </ul>

            <div class="quantity-section-large">
              <label for="whiteQuantity" class="quantity-label-large"><span class="quantity">Anzahl:</span></label>
              <div class="quantity-controls-large">
                <button type="button" class="quantity-btn-large" onclick="decreaseWhiteQuantity()">-</button>
                <input type="number" id="whiteQuantity" name="whiteQuantity" value="1" min="1" max="10" readonly class="quantity-input-large" />
                <button type="button" class="quantity-btn-large" onclick="increaseWhiteQuantity()">+</button>
              </div>
            </div>

            <div class="total-display-large total-card">
              <span class="total-label"><span class="total">Gesamt:</span></span>
              <span class="total-amount" id="whiteTotalAmount">1,70 €</span>
            </div>
          </div>
        </div>

        <!-- Black Flour Barbari Bread -->
        <div class="product-card">
          <div class="gallery card-3d image-elevated">
            <span class="ribbon ribbon-new"><i class="fas fa-star"></i> <span class="new">Neu</span></span>
            <div class="gallery-main">
              <img id="blackBreadImage"
                   src="Image/Non.jpg"
                   data-candidates="Image/Non.jpg,./Image/Non.jpg,/Image/Non.jpg,image/Non.jpg,Image/non.jpg,Non.jpg,./Non.jpg,/Non.jpg,https://via.placeholder.com/1200x800.png?text=Black+Bread"
                   loading="eager"
                   alt="Barbari-Brot mit schwarzem Mehl und Kleie" class="gallery-img"/>
              <span class="shine"></span>
            </div>
          </div>

          <div class="order-panel details-glass">
            <h3 class="product-title blackFlourBread">Barbari-Brot mit schwarzem Mehl und Kleie</h3>
            <div class="order-header-ui">
              <div class="price-chip"><span class="price-label">Preis:</span> <strong>1,70 €</strong></div>
              <div class="stock-chip"><i class="fas fa-check"></i> <span class="available-today">Heute verfügbar</span></div>
            </div>

            <ul class="usp-list">
              <li><i class="fas fa-bread-slice"></i> <span class="handmade">Handgemacht, knusprig außen – weich innen</span></li>
              <li><i class="fas fa-calendar"></i> <span class="baking-schedule">Backtage: Samstag und Sonntag (11:00-13:00 Uhr)</span></li>
              <li><i class="fas fa-leaf"></i> <span class="no-additives">Ohne Zusatzstoffe – gesund und nahrhaft für die Familie</span></li>
            </ul>

            <div class="quantity-section-large">
              <label for="blackQuantity" class="quantity-label-large"><span class="quantity">Anzahl:</span></label>
              <div class="quantity-controls-large">
                <button type="button" class="quantity-btn-large" onclick="decreaseBlackQuantity()">-</button>
                <input type="number" id="blackQuantity" name="blackQuantity" value="1" min="1" max="10" readonly class="quantity-input-large" />
                <button type="button" class="quantity-btn-large" onclick="increaseBlackQuantity()">+</button>
              </div>
            </div>

            <div class="total-display-large total-card">
              <span class="total-label"><span class="total">Gesamt:</span></span>
              <span class="total-amount" id="blackTotalAmount">1,70 €</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Single Order Button Section -->
      <div class="single-order-section">
        <div class="order-summary-card">
          <h3>Bestellübersicht</h3>
          <div class="order-items">
            <div class="order-item">
              <span class="product-name">Barbari-Brot mit weißem Mehl</span>
              <span class="quantity-display" id="whiteQuantityDisplay">1 Stück</span>
              <span class="price-display" id="whitePriceDisplay">1,70 €</span>
            </div>
            <div class="order-item">
              <span class="product-name">Barbari-Brot mit schwarzem Mehl und Kleie</span>
              <span class="quantity-display" id="blackQuantityDisplay">1 Stück</span>
              <span class="price-display" id="blackPriceDisplay">1,70 €</span>
            </div>
            <div class="order-total">
              <span class="total-label">Gesamt:</span>
              <span class="total-amount" id="grandTotalAmount">3,40 €</span>
            </div>
          </div>
          <button class="order-btn-large cta-pulse" onclick="openPhoneModal()">
            <i class="fas fa-check-circle"></i><span class="confirm-order">Bestellung bestätigen</span>
          </button>
        </div>
      </div>

    </div>
  </section>

  <!-- Quick Phone Modal -->
  <div id="phoneModal" class="modal" style="display:none;align-items:center;justify-content:center;">
    <div class="modal-content phone-modal">
      <div class="modal-header-ui">
        <h3 class="success-title phone-modal-title">Telefonnummer eingeben</h3>
        <button class="close-btn-ui" onclick="closePhoneModal()"><i class="fas fa-times"></i></button>
      </div>
      <p class="modal-desc phone-modal-desc">Wir rufen Sie zur Bestätigung an.</p>
      <div class="phone-input-wrap">
        <i class="fas fa-phone"></i>
        <input id="phoneInput" type="tel" class="phone-input" placeholder="z.B. +49 123 456" value="+49 ">
      </div>
      <button class="order-btn-large cta-pulse phone-submit" onclick="submitQuickOrder()" style="width:100%">
        <i class="fas fa-check"></i>Bestellung absenden
      </button>
    </div>
  </div>

  <script>
    let whiteQuantity = 1;
    let blackQuantity = 1;
    const breadPrice = 1.70;

    function increaseWhiteQuantity(){ 
      if(whiteQuantity<10){ 
        whiteQuantity++; 
        document.getElementById('whiteQuantity').value=whiteQuantity; 
        updateWhiteTotal(); 
        updateOrderSummary();
      } 
    }
    
    function decreaseWhiteQuantity(){ 
      if(whiteQuantity>1){ 
        whiteQuantity--; 
        document.getElementById('whiteQuantity').value=whiteQuantity; 
        updateWhiteTotal(); 
        updateOrderSummary();
      } 
    }
    
    function increaseBlackQuantity(){ 
      if(blackQuantity<10){ 
        blackQuantity++; 
        document.getElementById('blackQuantity').value=blackQuantity; 
        updateBlackTotal(); 
        updateOrderSummary();
      } 
    }
    
    function decreaseBlackQuantity(){ 
      if(blackQuantity>1){ 
        blackQuantity--; 
        document.getElementById('blackQuantity').value=blackQuantity; 
        updateBlackTotal(); 
        updateOrderSummary();
      } 
    }
    
    function updateWhiteTotal(){ 
      const total = whiteQuantity * breadPrice; 
      const el = document.getElementById('whiteTotalAmount'); 
      if(el){ el.textContent = total.toFixed(2).replace('.', ',') + ' €'; } 
    }
    
    function updateBlackTotal(){ 
      const total = blackQuantity * breadPrice; 
      const el = document.getElementById('blackTotalAmount'); 
      if(el){ el.textContent = total.toFixed(2).replace('.', ',') + ' €'; } 
    }
    
    function updateOrderSummary(){
      const whiteTotal = whiteQuantity * breadPrice;
      const blackTotal = blackQuantity * breadPrice;
      const grandTotal = whiteTotal + blackTotal;
      
      // Update order summary display
      document.getElementById('whiteQuantityDisplay').textContent = `${whiteQuantity} Stück`;
      document.getElementById('whitePriceDisplay').textContent = whiteTotal.toFixed(2).replace('.', ',') + ' €';
      document.getElementById('blackQuantityDisplay').textContent = `${blackQuantity} Stück`;
      document.getElementById('blackPriceDisplay').textContent = blackTotal.toFixed(2).replace('.', ',') + ' €';
      document.getElementById('grandTotalAmount').textContent = grandTotal.toFixed(2).replace('.', ',') + ' €';
    }
    
    
    document.addEventListener('DOMContentLoaded', function(){
      updateWhiteTotal();
      updateBlackTotal();
      updateOrderSummary();
    });

    function openPhoneModal(){ 
      document.getElementById('phoneModal').style.display='block'; 
    }
    function closePhoneModal(){ document.getElementById('phoneModal').style.display='none'; }

    function submitQuickOrder(){
      const phone = (document.getElementById('phoneInput').value||'').trim();
      if(!phone){ alert('Bitte Telefonnummer eingeben'); return; }
      
      // Check minimum order requirement (total of 2 breads)
      const totalBreads = whiteQuantity + blackQuantity;
      if(totalBreads < 2){
        alert('Mindestbestellung: 2 Brote insgesamt');
        return;
      }
      
      // Create order data with all products
      const whiteTotal = whiteQuantity * breadPrice;
      const blackTotal = blackQuantity * breadPrice;
      const grandTotal = whiteTotal + blackTotal;

      const orderData = {
        phone,
        products: [
          {
            productName: 'Barbari-Brot mit weißem Mehl',
            quantity: whiteQuantity,
            price: breadPrice,
            total: whiteTotal
          },
          {
            productName: 'Barbari-Brot mit schwarzem Mehl und Kleie',
            quantity: blackQuantity,
            price: breadPrice,
            total: blackTotal
          }
        ],
        totalPrice: grandTotal,
        totalAmount: grandTotal,
        firstName:'Kunde'
      };

      fetch('/api/order', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(orderData)
      })
      .then(async r=>{
        const raw = await r.text();
        let payload = null;
        try { payload = raw ? JSON.parse(raw) : null; } catch(e){ payload = { ok: r.ok, error: raw }; }
        if(!r.ok){ const msg = (payload && (payload.error||payload.message)) || raw || `HTTP ${r.status}`; throw new Error(msg);}
        return payload || { ok:true };
      })
      .then(data=>{
        if(data && data.ok){
          closePhoneModal();
          if(typeof showNotification==='function'){
            showNotification(window.orderSuccessMessage || 'Ihre Bestellung wurde registriert. Wir rufen Sie bald an.');
          } else {
            alert(window.orderSuccessMessage || 'Bestellung registriert.');
          }
        } else {
          alert('Fehler: '+(data && (data.error||data.message) || 'unknown'));
        }
      })
      .catch(err=> alert('Fehler: '+err.message));
    }

    window.onclick = function(ev){
      const m=document.getElementById('phoneModal');
      if(ev.target===m){ m.style.display='none'; }
    }
  </script>
</body>
</html>
